function normalizePath(t){return[].concat(t).join(".").split(".")}function getExpression(t){var r=t.indexOf("{{"),e=1,s=t.length,n=r;if(-1<r){for(r+=1;r<s&&0<e;)"{{"===t.substring(r,r+2)?(r+=1,e+=1):"}}"===t.substring(r,r+2)?(r+=2,e-=1):r++;return{outter:t.substring(n,r),string:t,start:n,end:r,value:t.substring(n+2,r-2).trim()}}return null}function filterExpression(t,r,e,s){var n,i=r.split(" "),o=t.filter[i[0]],u=i.slice(1).join(" "),a=[""],l=0,f=-1,g=u.length;if(o){for(;++f<g;)a[l]||(a[l]=""),"{{"===u.substring(f,f+2)?(n=getExpression(u.substring(f)))?(f+=n.end,a[l]=evaluateExpression(t,n.outter,e,s),l+=1):a[l]+=u[f]:/\s/.test(u[f])&&!/\s/.test(u[f-1])?l+=1:a[l]+=u[f];return o.apply(t,a)}return r}function replaceExpression(t,r,e,s){var n=r.string.substring(0,r.start),i=r.string.substring(r.end,r.string.length),o=r.value;return t.defs.hasOwnProperty(o)?o=t.defs[o]:s.length&&void 0!==s[Number(o)]?o=s[Number(o)]:e.hasOwnProperty(o)&&(o=e[o]),n+(o=evaluateExpression(t,o=filterExpression(t,o=""+o,e,s),e,s))+i}function evaluateExpression(t,r,e,s){for(var n=r,i=getExpression(n);i;)i=getExpression(n=replaceExpression(t,i,e,s));return n}function get(t,r){for(var e=t,s=normalizePath(r),n=0,i=s.length-1;n<i;n++){if(!e||void 0===e[s[n]])return;e=e[s[n]]}return e[s.slice(-1)[0]]}
/**
 * @param {object=} props
 * @param {object=} props.defs Language definitions
 * @param {object=} props.filter Language filters
*/function Language(t){this.defs={},this.filter={},this.onloadSubscribers=[],this.load(t)}Language.prototype.onLoad=function(t){return-1===this.onloadSubscribers.indexOf(t)&&this.onloadSubscribers.push(t),this},Language.prototype.offLoad=function(t){var r=this.onloadSubscribers.indexOf(t);return-1<r&&this.onloadSubscribers.splice(r,1),this},
/**
 * @param {object=} props
 * @param {object=} props.defs Language definitions
 * @param {object=} props.filter Language filters
*/
Language.prototype.load=function(t){var r=-1,e=this.onloadSubscribers.length;if(t&&t.defs&&Object.assign(this.defs,t.defs),t&&t.filters){for(var s in t.filters)this.filter[s]=t.filters[s].bind(this);t.filters.constructor&&t.filters.constructor.call(this)}for(;++r<e;)this.onloadSubscribers[r].call(this);return this},
/**
 * @param {string|array} path
 * @param {object=} template A template to process
 * @returns {string|undefined};
*/
Language.prototype.get=function(t,r){var e=get(this.defs,t)||normalizePath(t).join("."),s=[],n=0,i=arguments.length;for(r=r||{};++n<i;)s.push(arguments[n]);return"string"==typeof e?evaluateExpression(this,e,r,s):e},module.exports=Language;